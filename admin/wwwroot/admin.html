<!DOCTYPE html>
<!--
Template Name: Admin Lab Dashboard build with Bootstrap v2.3.1
Template Version: 1.2
Author: Mosaddek Hossain
Website: http://thevectorlab.net/
-->

<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
	<meta charset="utf-8" />
	<title> Gomore Dashboard</title>
	<meta content="width=device-width, initial-scale=1.0" name="viewport" />
	<meta content="" name="description" />
	<meta content="" name="author" />
	<link href="admin_lap/assets/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
	<link href="admin_lap/assets/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" />
	<link href="admin_lap/assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
	<link href="admin_lap/css/style.css" rel="stylesheet" />
	<link href="admin_lap/css/style_responsive.css" rel="stylesheet" />
	<link href="admin_lap/css/style_default.css" rel="stylesheet" id="style_color" />
 
	<link rel="stylesheet" type="text/css" href="admin_lap/assets/uniform/css/uniform.default.css" />  
	<script src="admin_lap/js/jquery-1.8.3.min.js"></script>
	<script src="admin_lap/js/nano.js"></script> 
	<script src="admin_lap/js/echarts.simple.min.js"></script>
	
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<body class="fixed-top">
	<!-- BEGIN HEADER -->
	<div id="header" class="navbar navbar-inverse navbar-fixed-top">
		
		<script type="text/javascript">
		$(document).ready(function(){
			$("#header").load('./header.html');
 		});
		</script>
	</div>
	<!-- END HEADER -->
	<!-- BEGIN CONTAINER -->
	<div id="container" class="row-fluid">
		<!-- BEGIN SIDEBAR -->
		<div id="sidebar" class="nav-collapse collapse">
			<script type="text/javascript">
			$(document).ready(function(){
				$("#sidebar").load('./sidebar.html');
			});
			</script>
		</div>
		<!-- END SIDEBAR -->
		<!-- BEGIN PAGE -->
		<div id="main-content">
			<!-- BEGIN PAGE CONTAINER-->
			<div class="container-fluid">
				<!-- BEGIN PAGE HEADER-->
				<div class="row-fluid">
					<div class="span12">
						<!-- BEGIN THEME CUSTOMIZER-->
						<div id="theme-change" class="hidden-phone">
							<i class="icon-cogs"></i>
							<span class="settings">
                                <span class="text">风格:</span>
                                <span class="colors">
                                    <span class="color-default" data-style="default"></span>
                                    <span class="color-gray" data-style="gray"></span>
                                    <span class="color-purple" data-style="purple"></span>
                                    <span class="color-navy-blue" data-style="navy-blue"></span>
                                </span>
							</span>
						</div>
						<!-- END THEME CUSTOMIZER-->
						<!-- BEGIN PAGE TITLE & BREADCRUMB-->
						<h3 class="page-title">
							控制面板
							<small> 仪表信息 </small>
						</h3>
						 
						<!-- END PAGE TITLE & BREADCRUMB-->
					</div>
				</div>
				<!-- END PAGE HEADER-->
				<!-- BEGIN PAGE CONTENT-->
				<div id="page" class="dashboard">
                    <!-- BEGIN OVERVIEW STATISTIC BLOCKS-->
                    <div class="row-fluid circle-state-overview">
                        <div class="span2 responsive" data-tablet="span3" data-desktop="span2">
                            <div class="circle-stat block">
                              
                                <div class="details">
                                    <div class="number" id="label_conns">0</div>
                                    <div class="title">并发数</div>
                                </div>

                            </div>
                        </div>
                        <div class="span2 responsive" data-tablet="span3" data-desktop="span2">
                            <div class="circle-stat block">
                                
                                <div class="details">
                                    <div class="number" id="label_qps" >0</div>
                                    <div class="title">吞吐量</div>
                                </div>

                            </div>
                        </div>


                        <div class="span2 responsive" data-tablet="span3" data-desktop="span2">
                            <div class="circle-stat block">
                                
                                <div class="details">
                                    <div class="number" id="label_cpu">-</div>
                                    <div class="title">CPU</div>
                                </div>

                            </div>
                        </div>

                        <div class="span2 responsive" data-tablet="span3" data-desktop="span2">
                            <div class="circle-stat block">
                                 
                                <div class="details">
                                    <div class="number" id="label_mem">-</div>
                                    <div class="title">内存</div>
                                </div>

                            </div>
                        </div>

                       <!-- <div class="span2 responsive" data-tablet="span3" data-desktop="span2">
                            <div class="circle-stat block">
                                
                                <div class="details">
                                    <div class="number">90%</div>
                                    <div class="title">网络</div>
                                </div>

                            </div>
                        </div>


                        <div class="span2 responsive" data-tablet="span3" data-desktop="span2">
                            <div class="circle-stat block">
                                
                                <div class="details">
                                    <div class="number">478</div>
                                    <div class="title">读写i/o</div>
                                </div>

                            </div>
                        </div>-->
                    </div>
                    <!-- END OVERVIEW STATISTIC BLOCKS-->

					<div class="row-fluid">
						<div class="span6">
							<!-- BEGIN SITE VISITS PORTLET-->
							<div class="widget"  >
								<div class="widget-title">
									<h4><i class="icon-bar-chart"></i> 并发数</h4>
									<span class="tools">
									<a href="javascript:;" class="icon-chevron-down"></a> 
									</span>
								</div>
								<div class="widget-body"  >
								 
									<div id="conns_chart" class="chart" style="height:185px"  >
										 
									</div>
									
									 

								</div>
							</div>
							<!-- END SITE VISITS PORTLET-->
							
						</div>
						<div class="span6">
							<!-- BEGIN SITE VISITS PORTLET-->
							<div class="widget"  >
								<div class="widget-title">
									<h4><i class="icon-bar-chart"></i> 吞吐量</h4>
									<span class="tools">
									<a href="javascript:;" class="icon-chevron-down"></a> 
									</span>
								</div>
								<div class="widget-body"  >
									<div id="qps_chart" class="chart" style="height:185px" >
										 
									</div>
									 
									 
								</div>
							</div>
							<!-- END SITE VISITS PORTLET-->
							
						</div>
                     

					</div>
					
					<div class="row-fluid">
                        <div class="span12">
							<div class="widget">
                                <div class="widget-title">
                                    <h4><i class="icon-umbrella"></i> cpu使用率 </h4>
									<span class="tools">
									<a href="javascript:;" class="icon-chevron-down"></a> 
									</span>
                                </div>
                                <div class="widget-body">
                                    <div id="cpu_chart" class="chart" style="height:150px">
										 
									</div>
                                </div>
                            </div>
						</div>
						
					</div>	
				 
                      
                    <div class="row-fluid">
                        <div class="span12">
                            <!-- BEGIN RECENT ORDERS PORTLET-->
                            <div class="widget">
                                <div class="widget-title">
                                    <h4><i class="icon-tags"></i> 最新日志</h4>
                                        <span class="tools">
                                        <a href="javascript:;" class="icon-chevron-down"></a>
                                  
                                        </span>
                                </div>
                                <div class="widget-body" >
                                    <table class="table table-striped table-bordered table-advance table-hover">
									    <thead>
									    <tr>
									        <th><i class="icon-leaf"></i> <span class="hidden-phone">级别</span></th>
									        <th><i class="icon-user"></i> <span class="hidden-phone ">内容</span></th>
									        <th><i class="icon-tags"> </i><span class="hidden-phone">时间</span></th>
									        <th>操作</th>
									    </tr>
									    </thead> 
										<tbody id="content" >
										
										</tbody>
										
									</table>
									<div class="space7"></div>
									<div class="clearfix">
									    <a href="#" class="btn btn-mini pull-right">更多日志</a>
									</div>
                                    
                                </div>
                            </div>
                            <!-- END RECENT ORDERS PORTLET-->
                        </div>

					</div>  
                 
                         
                   
			 
							<!-- BEGIN CALENDAR PORTLET-->
						 
							 
							<!-- END CALENDAR PORTLET-->
					 
                        
                            <!-- BEGIN TODO_LIST PORTLET-->
                      
					 
                            <!-- END TODO_LIST PORTLET-->
                       
					 
				</div>
				<!-- END PAGE CONTENT-->
			</div>
			<!-- END PAGE CONTAINER-->
		</div>
		<!-- END PAGE -->
	</div>
	<!-- END CONTAINER -->
	<!-- BEGIN FOOTER -->
	<div id="footer">

			<script type="text/javascript">
			$(document).ready(function(){
				$("#footer").load('./footer.html');
			});
			</script>
	</div>
	<!-- END FOOTER -->
	<!-- BEGIN JAVASCRIPTS -->
	<!-- Load javascripts at bottom, this will reduce page load time -->
	
	<script src="admin_lap/assets/jquery-slimscroll/jquery-ui-1.9.2.custom.min.js"></script>
	<script src="admin_lap/assets/jquery-slimscroll/jquery.slimscroll.min.js"></script> 
	<script src="admin_lap/assets/bootstrap/js/bootstrap.min.js"></script>
	<script src="admin_lap/js/jquery.blockui.js"></script>
	<script src="admin_lap/js/jquery.cookie.js"></script>
	<!-- ie8 fixes -->
	<!--[if lt IE 9]>
	<script src="admin_lap/js/excanvas.js"></script>
	<script src="admin_lap/js/respond.js"></script>
	<![endif]-->
	<script src="admin_lap/js/scripts.js"></script>
  	<script>
		jQuery(document).ready(function() {
			// initiate layout and plugins
			App.setMainPage(true);
			App.init();
			
			fetch_stats(); 
			fetch_lastlogs();
		}); 
                
 	</script>

	<script type="text/javascript">
	
	
		
		$('#cpu_chart').show();
		$('#qps_chart').show();
        // 基于准备好的dom，初始化echarts实例
        var cpu_chart     = echarts.init(document.getElementById('cpu_chart')); 
        var qps_chart     = echarts.init(document.getElementById('qps_chart'));
		var conns_chart   = echarts.init(document.getElementById('conns_chart'));
		
		var cpu_time = []
		var cpu_data = [] 
		var qps_data = []
		var conns_data = []
		
        // 指定图表的配置项和数据
		
		var conns_option = {
            title: {
                text: '并发数'
            }, 
            tooltip: {},
            legend: {
                data:[],
				height:"200px"
            }, 
            yAxis: {},
			xAxis: {
                data: [ ]
            },
			grid:{
					x:25,
					y:5,
					y2:55,
					height:150 
			},

            series: [{
                name: '并发数',
                type: 'line',
                data: [ ],
				color:'#3DEE11'
            }]
        };
		
        
		 
        // 指定图表的配置项和数据
        var qps_option = {
            title: {
                text: '吞吐量'
            }, 
            tooltip: {},
            legend: {
                data:[],
				height:"200px"
            }, 
            yAxis: {},
			xAxis: {
                data: [ ]
            },
			grid:{
					x:25,
					y:5,
					y2:55,
					height:150 
			},
            series: [{
                name: '吞吐量',
                type: 'line',
                data: [ ]
            }]
        };
		
		var cpu_option = {
            title: {
                text: 'cpu使用率'
            }, 
            tooltip: {},
            legend: {
                data:[],
				height:"auto"
            }, 
            yAxis: {},
			xAxis: {
                data: [],
				max : 100
            },
			grid:{
					x:25,
					y:5,
					y2:35,
					height:120 
			},

            series: [{
                name: 'cpu',
                type: 'line',
				max:100,
				smooth:true,
	            symbol: 'none',
	            stack: 'a',
				itemStyle: {
	                normal: {
	                    color: '#3DEE11'
	                }
	            },
	            areaStyle: {
	                normal: {},
					color: '#3DEE11'
	            },
                data: []
            }]
        };
		
		 
      	cpu_chart.setOption(cpu_option);
		conns_chart.setOption(conns_option);
        qps_chart.setOption(qps_option); 
        
		function fetch_stats(){
			
			$.getJSON("./stats", function (data) {
			    cpu_chart.hideLoading();
				conns_chart.hideLoading(); 
				qps_chart.hideLoading(); 
				
				cpu_time.push(data.time);
				cpu_data.push( data.cpu_per[0]);
				conns_data.push( data.conns );
				qps_data.push( data.qps );
				
				$('#label_cpu').html( data.cpu_per[0]+"%");
				$('#label_conns').html( data.conns);
				$('#label_mem').html( parseInt(data.mem_use_per)+"% of " +parseInt(parseInt(data.mem_total)/1024/1024) +"M");
				$('#label_qps').html( data.qps);
				
			    cpu_chart.setOption({
			        xAxis: {
			            data: cpu_time
			        },
			        series: [{
			            // 根据名字对应到相应的系列
			            name: 'cpu',
			            data:cpu_data
			        }]
			    });
				qps_chart.setOption({
			        xAxis: {
			            data: cpu_time
			        },
			        series: [{
			            // 根据名字对应到相应的系列
			            name: 'cpu',
			            data:qps_data
			        }]
			    });
				conns_chart.setOption({
			        xAxis: {
			            data: cpu_time
			        },
			        series: [{
			            // 根据名字对应到相应的系列
			            name: 'cpu',
			            data:conns_data
			        }]
			    });
				
			});
			
		}
		
		function fetch_lastlogs(){
			
			$.getJSON("./lastlogs", function (data) {
			      
				var html; 
				html = '';	
				var level = '';
				for(var i=0;i<data.length;i++){
					level =  data[i].Level;
					data[i].levelCss = 'info';
					if( level=='debug'  ) data[i].levelCss = 'info';
					 
					if( level=='info'   ) data[i].levelCss = 'success';
					 
					if( level=='warn'   ) data[i].levelCss = 'warning';
					 
					if( level=='error' || level=='fatal' || level=='panic'   ) {
						data[i].levelCss = 'important';
					}
					
					if( data[i].Time>0 ) {
						data[i].TimeStr =  js_date_time( data[i].Time );	
					}else{
						data[i].TimeStr  = '';
					} 
					data[i].MessageStr =  subString( data[i].Message ,50, true  );
					
				 	html =html+nano( $("#lastlog_tpl").html(),data[i] );
				} 
				//console.log( html )
				document.getElementById('content').innerHTML = html;
 				$('.popovers').popover();
				
			});
			
		}
		timer = setInterval(function () {
		  
			fetch_stats(); 
		     
		}, 2000);

		
    </script>
	
	
<script id="lastlog_tpl" type="text/html">
	<tr>
        <td class="highlight">
            <div class="{levelCss}"></div>
            <a href="#">{Level}</a>
        </td>
        <td>{MessageStr}</td>
        <td>
            {TimeStr}
        </td>
        <td>
		<button class="btn btn-mini hidden-phone hidden-tablet popovers" 
		  data-trigger="click" data-placement="left" data-content="{Message}" 
		  data-original-title="日志详情">详情</button>
	 
    </tr> 
</script>

	<!-- END JAVASCRIPTS -->
</body>
<!-- END BODY -->
</html>